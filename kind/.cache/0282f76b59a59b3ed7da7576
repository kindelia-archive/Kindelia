#K #V #k #v #l #r !size_l = (((BBT.size K) V) l); !size_r = (((BBT.size K) V) r); !size_l_plus_size_r = ((U32.add size_l) size_r); !w_x_size_l = ((U32.mul BBT.w) size_l); !w_x_size_r = ((U32.mul BBT.w) size_r); (((((U32.ltn size_l_plus_size_r) (Nat.to_u32 +2)) # ((BBT K) V)) ((((((BBT.node K) V) k) v) l) r)) (((((U32.gtn size_r) w_x_size_l) # ((BBT K) V)) (((r #r ((BBT K) V)) ((((((BBT.node K) V) k) v) l) r)) #r.size #r.key #r.val #r.left #r.right !size_rl = (((BBT.size K) V) r.left); !size_rr = (((BBT.size K) V) r.right); (((((U32.ltn size_rl) size_rr) # ((BBT K) V)) !new_key = r.key; !new_val = r.val; !new_left = ((((((BBT.node K) V) k) v) l) r.left); !new_right = r.right; ((((((BBT.node K) V) new_key) new_val) new_left) new_right)) (((r.left #r.left ((BBT K) V)) ((((((BBT.node K) V) k) v) l) r)) #r.left.size #r.left.key #r.left.val #r.left.left #r.left.right !new_key = r.left.key; !new_val = r.left.val; !new_left = ((((((BBT.node K) V) k) v) l) r.left.left); !new_right = ((((((BBT.node K) V) r.key) r.val) r.left.right) r.right); ((((((BBT.node K) V) new_key) new_val) new_left) new_right))))) (((((U32.gtn size_l) w_x_size_r) # ((BBT K) V)) (((l #l ((BBT K) V)) ((((((BBT.node K) V) k) v) l) r)) #l.size #l.key #l.val #l.left #l.right !size_ll = (((BBT.size K) V) l.left); !size_lr = (((BBT.size K) V) l.right); (((((U32.ltn size_lr) size_ll) # ((BBT K) V)) !new_key = l.key; !new_val = l.val; !new_left = l.left; !new_right = ((((((BBT.node K) V) k) v) l.right) r); ((((((BBT.node K) V) new_key) new_val) new_left) new_right)) (((l.right #l.right ((BBT K) V)) ((((((BBT.node K) V) k) v) l) r)) #l.right.size #l.right.key #l.right.val #l.right.left #l.right.right !new_key = l.right.key; !new_val = l.right.val; !new_left = ((((((BBT.node K) V) l.key) l.val) l.left) l.right.left); !new_right = ((((((BBT.node K) V) k) v) l.right.right) r); ((((((BBT.node K) V) new_key) new_val) new_left) new_right))))) ((((((BBT.node K) V) k) v) l) r))))